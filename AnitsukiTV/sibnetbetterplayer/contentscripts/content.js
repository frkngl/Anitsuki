!function(){"use strict";function e(){u&&window.location.reload(),o()}function n(){var e=null,n=null,s=null,l=`${c}/upload/preview/preview/nonce_`,p=$("#player_container"),d=p.find('param[name="flashvars"]');if(d.length)e=d.val(),n=r(e,"file").replace(".m3u8",".mp4"),s=c+decodeURIComponent(r(e,"image")),t(n,s,l,p);else if((d=p.find("#video_html5_wrapper")).length)if((e=p.next("script").text().replace(/\s/g,"")).length){const r=c+a(e,'player.src([{src:"','",type:');s=c+a(e,'"poster":\'','\',"hls"'),l=c+a(e,'progressTips({"preview":"','"});'),i("if(videojsPlayer && videojsPlayer.pause){ videojsPlayer.pause(); }"),fetch(r,{method:"head"}).then(e=>{e.url?(i('if(videojsPlayer && videojsPlayer.pause){ videojsPlayer.on("play", function(){ videojsPlayer.pause(); }); }'),t(n=e.url.replace(/\/manifest\.mpd/,".mp4"),s,l,p)):o()}).catch(()=>o())}else o();else o()}function t(e,n,t,a){function r(){b.pause(),$(b.elements.container).removeClass("plyr--menu-open"),$(b.elements.buttons.settings).attr("aria-expanded","false"),$(b.elements.settings.popup).prop("hidden",!0)}const i=$('link[rel="canonical"]').attr("href"),c=a.find('track[kind="captions"]');g=e.split("."),(g=g[2].split("/")).splice(0,1),u=$(`<div class="SNDP-wrapper"><video preload="auto" poster="${n}"><source src="${e}" type="video/mp4"></video></div>`),c.length&&u.find("video").append(c.attr("srclang","en")),a.after(u).remove();let b=new Plyr(u.find("video")[0],{disableContextMenu:!1,loadSprite:!1,seekTime:5,keyboard:{focused:!1,global:!0},controls:["play-large","play","progress","current-time","duration","mute","volume","pip","airplay","fullscreen","settings","captions"],captions:{active:!0,language:"en"},tooltips:{controls:!0,seek:!0},settings:["speed"],i18n:"ru"===v?y:{}});$(b.elements.controls).find(".plyr__control").click(function(){this.blur()}),b.on("error",e=>{console.warn("SIBNET BETTERPLAYER ERROR:",e)});const w=$(b.elements.settings.panels.home).find('[role="menu"]');let k=$(`<a href="${e}" target="_blank" download data-plyr="settings" type="button" class="plyr__control" role="menuitem"><span>${p("btn_download")}</span></a>`),_=$(`<a href="https://${i?i.split("//")[1]:"video.sibnet.ru"}" target="_blank" data-plyr="settings" type="button" class="plyr__control" role="menuitem"><span>${p("btn_open")}</span></a>`);w.append(k),k.click(r),"/shell.php"===window.location.pathname&&(w.append(_),_.click(r)),h=t,$.when(function(e){var n=$.Deferred(),t=new XMLHttpRequest;try{t.open("HEAD",decodeURIComponent(e),!0)}catch(e){return n.reject(e.message),n.promise()}return t.onload=function(){t.status>=400?n.reject(t.status):n.resolve(t.responseURL)},t.send(null),n.promise()}(`${h}1.jpg`)).then(()=>{m=$('<div class="SNDP-thumbnail"></div>').appendTo(b.elements.progress),f=$(b.elements.progress).mousemove(()=>{s()}).hover(()=>{s(),m.addClass("SNDP-thumbnail--visible")},()=>{m.removeClass("SNDP-thumbnail--visible")}).find(".plyr__tooltip"),l(1)}),(window.location.search.indexOf("autoplay")>-1||"/shell.php"!==window.location.pathname)&&b.play(),$("#sprite-plyr").length||$.get(chrome.extension.getURL("vendor/plyr.svg"),function(e){d.prepend($('<div id="sprite-plyr" hidden>').html(e))},"text"),o()}function s(){const e=parseFloat(f.css("left"));m.css({left:e<58?58:e});let n=f.text().split(":").reverse(),t=parseInt(n[0]);n[1]&&(t+=60*parseInt(n[1])),n[2]&&(t+=60*parseInt(n[2])*60);let s=Math.ceil((t+1)/5),l=Math.ceil(s/72),o=s-72*(l-1),a=Math.ceil(o/12)-1,r=108*a,i=192*(o-12*a-1);m.css({"background-image":`url(${h}${l}.jpg)`}),m.css({"background-position":`-${i}px -${r}px`})}function l(e){$.get(`${h}${e}.jpg`).then(()=>{l(e+1)})}function o(){$(document.documentElement).addClass("SNDP-show")}function a(e,n,t){return e.substring(e.indexOf(n)+n.length,e.indexOf(t))}function r(e,n){return e.substring(e.indexOf(n+"=")+(n.length+1)).split("&")[0]}function i(e){d.append("<script>"+e+"<\/script>")}function p(e){return chrome.i18n.getMessage(e)}const c=window.location.protocol+"//video.sibnet.ru",d=$("body");let u=null,m=null,f=null,g=null,h=null;const v=p("extension_lang"),y={restart:"Перезапустить",rewind:"Перемотпть на {seektime}c",play:"Смотреть (k)",pause:"Пауза (k)",fastForward:"Пропустить {seektime}с",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Просмотрено",buffered:"Буферизовано",currentTime:"Текущее время",duration:"Длительность",volume:"Громкость",mute:"Отключить звук (m)",unmute:"Включить звук (m)",enableCaptions:"Включить субтитры (c)",disableCaptions:"Отключить субтитры (c)",download:"Скачать",enterFullscreen:"Во весь экран (f)",exitFullscreen:"Выйти из полноэкранного режима (f)",captions:"Субтитры",settings:"Настройки",menuBack:"Вернуться к предыдущему меню",speed:"Скорость",normal:"Обычная",quality:"Качество",loop:"Повтор",start:"Начало",end:"Конец",all:"Все",reset:"Сбросить",disabled:"Отключено",enabled:"Включено",pip:"Картинка в картинке"};chrome.storage.sync.get(function(t){t.enabled?n():e()}),chrome.storage.onChanged.addListener(function(t){t.enabled&&(t.enabled.newValue?n():e())})}();